@page "/editmodule/{ModuleId:guid}"

@using System.Net.Http
@using System.Net.Http.Json
@using LMS.Shared.Dtos
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Edit Module</h3>

@if (module == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <form>
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" class="form-control" id="name" @bind="module.Name" />
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea class="form-control" id="description" @bind="module.Description"></textarea>
        </div>

        <button type="button" class="btn btn-primary" @onclick="UpdateModule">Update</button>
        <a href="/modulelist" class="btn btn-secondary">Cancel</a>
    </form>
}

@code {
    private ModuleDTO module;

    [Parameter]
    public Guid ModuleId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await FetchModule();
    }

    private async Task FetchModule()
    {
        module = await Http.GetFromJsonAsync<ModuleDTO>($"https://localhost:7050/api/module/{ModuleId}");
    }

    private async Task UpdateModule()
    {
        // Perform update logic here
        var response = await Http.PutAsJsonAsync($"https://localhost:7050/api/module/{ModuleId}", module);
        response.EnsureSuccessStatusCode();

        // Redirect to the module list after update
        Navigation.NavigateTo("/modulelist");
    }
}